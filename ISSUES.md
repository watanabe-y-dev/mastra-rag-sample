# Issues

現在の実装の課題と将来的な改善案。

---

## Issue #1: 大きなドキュメントのコンテキストウィンドウ圧迫

### 課題

現在の実装では、検索結果としてドキュメントの全文を返している（`src/rag.ts`）。

**問題点:**
- 大きなドキュメント（50,000 文字以上）の場合、Claude Desktop のコンテキストウィンドウを圧迫
- トークン数増加によるレスポンス低下と API コスト増加
- 必要な部分だけでなく全体を読み込む必要がある

**現状:**
- サンプル: 2,133 文字（問題なし）
- 実用時: 10,000〜100,000 文字（問題あり）

### 解決策

#### 1. チャンキング (Chunking) - 推奨

ドキュメントを小さな塊（500〜1,000 文字）に分割して保存。検索時は関連チャンクのみを返す。

- メリット: トークン削減、検索精度向上、大規模ドキュメント対応
- デメリット: 実装が複雑、ドキュメント数増加、チャンク境界で文脈が切れる可能性

#### 2. コンテンツプレビュー

検索結果で最初の N 文字だけを返す。

- メリット: 実装がシンプル
- デメリット: 検索精度低下、重要情報が末尾にある場合に対応できない

#### 3. ハイブリッド検索

チャンキング + 全文検索の組み合わせ。

- メリット: 高精度、文脈保持
- デメリット: 最も複雑

### 推奨アプローチ

1. Phase 1（現状）: シンプルな全文返却 - 小規模ドキュメント（〜5,000 文字）には十分
2. Phase 2: チャンキングの実装 - `src/chunking.ts` を作成
3. Phase 3: オーバーラップチャンキング、動的サイズ調整、再ランキング
